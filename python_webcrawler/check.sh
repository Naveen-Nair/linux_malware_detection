#!/usr/bin/bash

# Downloading files from vx-heaven
mkdir output/download 2> /dev/null
arr=($(awk -F ',' '{print $2}' output/links.csv))
for key in "${arr[@]}"
do
    #file endings are inconsistent => update based on ending 
    key2="${key%.*}.7z"
    wget --directory output/download $key2
    key3="${key2##*/}"
    #Unzipping and deleting the .7z file
    7za e 'output/download/'$key3 -p'infected' -o'output/download/'
    rm output/download/$key3
    #Getting list of families and file endings
    grep $key3 output/links.csv | awk -F "," '{print $1}' >> output/families.csv
    #Need to add the type of families
done
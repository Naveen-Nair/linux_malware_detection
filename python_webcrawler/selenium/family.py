from selenium import webdriver
from selenium.webdriver.common.by import By
import csv
import sys
import tqdm

###########################################################################################################################################################################
if(len(sys.argv)!=2) :
    print('Enter family param')
    exit()

###########################################################################################################################################################################

family = sys.argv[1]
filename = "output/"+family+".csv"

###########################################################################################################################################################################


driver = webdriver.Firefox()
family_links = []

driver.get("https://www.vx-underground.org/#E:/root/Samples/Families/"+family)
thing = driver.find_element(By.CLASS_NAME, 'tablesorter')
viruses = thing.find_elements(By.CSS_SELECTOR, 'tbody>tr')
if(len(viruses)>=2 and viruses[1].find_element(By.CSS_SELECTOR, 'a').text == 'Samples'):
    driver.get("https://www.google.com/")
    driver.get("https://www.vx-underground.org/#E:/root/Samples/Families/"+family+"/Samples")
    thing = driver.find_element(By.CLASS_NAME, 'tablesorter')
    viruses = thing.find_elements(By.CSS_SELECTOR, 'tbody>tr')
flag = False
for i in tqdm.tqdm(range(len(viruses)), desc="Parsing..."):
    virus = viruses[i]
    anchor = virus.find_element(By.CSS_SELECTOR, 'a')
    size = virus.find_element(By.CSS_SELECTOR, '.size').text.split(' ')
    if(size[1]=='GB' or (size[1]=='MB' and float(size[0]) > 10)):
        continue
    flag = True
    family_links.append([anchor.get_attribute('href')])


###########################################################################################################################################################################

driver.close()

with open(filename, mode='w') as links_csv:
    links_writer = csv.writer(links_csv, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
    links_writer.writerows(family_links)


###########################################################################################################################################################################
